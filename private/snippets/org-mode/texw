# -*- mode: snippet -*-
# See https://github.com/tsdye/LKFS for some other useful tweaks.
# name: texw
# key: texw_
# expand-env: ((yas-indent-line 'nil) (yas-wrap-around-region 'nil) (org-adapt-indentation 'nil))
# --

#+TITLE: ${1:title}
#+AUTHOR: Brandon T. Willard
#+DATE: `(format-time-string "%Y-%m-%d")`
#+EMAIL: brandonwillard@gmail.com

#+OPTIONS: ^:nil toc:nil tex:t d:results
#+SELECT_TAGS: export
#+EXCLUDE_TAGS: noexport

#+PROPERTY: header-args :eval never-export :exports both :results output drawer replace
#+PROPERTY: header-args+ :session

#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="../extra/custom.css" />

#+LaTeX_CLASS: article
#+LaTeX_HEADER: \usepackage{amsfonts}
#+LaTeX_HEADER: \usepackage{setspace}
#+LaTeX_HEADER: \usepackage{amsthm}
#+LaTeX_HEADER: \usepackage{mathtools}
#+LaTeX_HEADER: \usepackage{subcaption}
#+LaTeX_HEADER: \usepackage{suffix}
#+LaTeX_HEADER: \RequirePackage{color}
#+LaTeX_HEADER: \usepackage{adjustbox}

#+LaTeX_HEADER: \include{math-commands}

#+LaTeX_HEADER_EXTRA: \usepackage{todonotes}
#+LATEX_HEADER_EXTRA: \usepackage{draftwatermark}
#+LATEX_HEADER_EXTRA: \SetWatermarkScale{1}
#+LATEX_HEADER_EXTRA: \SetWatermarkLightness{0.90}
#+LATEX_HEADER_EXTRA: \definecolor{bg}{rgb}{0.95,0.95,0.95}

#+LaTeX_HEADER_EXTRA: \definecolor{bg}{rgb}{0.95,0.95,0.95}

#+LaTeX_HEADER_EXTRA: \usepackage[authoryear]{natbib}
#+LaTeX_HEADER_EXTRA: \usepackage{cleveref}

#+LaTeX_HEADER_EXTRA: \allowdisplaybreaks
#+LaTeX_HEADER_EXTRA: \setkeys{Gin}{keepaspectratio}
#+LaTeX_HEADER_EXTRA: \graphicspath{{../../figures/}{../figures/}{./figures/}{./}}

# Minted should be imported automatically by org-mode when \`org-latex-listings\` is \`minted\`.
#+LaTeX_HEADER_EXTRA: \setminted{fontsize=\footnotesize, breaklines=true, breakanywhere=true, breakautoindent=true}

# This env is really useful if you want to force tables into the page width.
#+LaTeX_HEADER_EXTRA: \usepackage{adjustbox}
#+LaTeX_HEADER_EXTRA: \newenvironment{adjusttabular}[1]{\begin{adjustbox}{max width=\maxtabfigwidth,max totalheight=\maxtabfigheight,center,tabular=#1}}{\end{adjustbox}}
#+LaTeX_HEADER_EXTRA: \newlength{\maxtabfigwidth}
#+LaTeX_HEADER_EXTRA: \newlength{\maxtabfigheight}

# This is how we produce multi-page listings that use minted.
#+LaTeX_HEADER_EXTRA: \usepackage{tcolorbox}
#+LaTeX_HEADER_EXTRA: \tcbuselibrary{minted, listings, breakable, skins}
#+BEGIN_EXPORT latex
%\AtBeginDocument{%
  \setlength{\maxtabfigwidth}{\textwidth}
  \setlength{\maxtabfigheight}{\textheight}
  % decrease height a bit letting captions fit to one page
  \addtolength{\maxtabfigheight}{-2.5em}

  \renewtcblisting[blend into=listings]{listing}[1][]{
    breakable,
    enhanced,
    arc=0pt,
    outer arc=0pt,
    boxrule=0pt,
    text only,
    listing remove caption=false,
    coltitle=black,
    % boxed title style={empty, size=minimal},
    % attach boxed title to bottom center={yshift=-10pt},
    float,
    floatplacement=\ifx\relax#1\relax htb\else #1\fi
  }
%}
#+END_EXPORT

#+BEGIN_abstract
  $2
#+END_abstract

* Introduction

  $0

* Conclusion


# This is a hackish way to get \`org-ref\` working.
#+BIBLIOGRAPHY: ../tex/bib-file-name

#+NAME: org_ref_bib_settings
#+BEGIN_SRC elisp :eval t :exports results :results value raw
(or (when-let* ((project-root (ignore-errors (projectile-project-root)))
                (file-name (car-safe (ignore-errors (f-glob "src/tex/*.bib" project-root))))
                (bib-style (if (eq org-export-current-backend 'latex)
                               "bibliographystyle:plainnat"
                             (concat "* References\nbibliographystyle:unsrt"))))
      (concat bib-style
              "\n"
              ;; Bug in \`org-ref' requires that we split this string.
              "bibl" "iography:" (f-filename file-name)))
    "")
#+END_SRC

* post-org-setup                                                           :noexport:

#+NAME: figure_wrap
#+HEADER: :var data=""
#+HEADER: :var caption=""
#+HEADER: :var label=""
#+HEADER: :var orgwidth="400"
#+HEADER: :var width="1.0\\textwidth"
#+BEGIN_SRC elisp :exports none :results silent value
(s-join "\n"
        \`(;; Correct the below setting when org doesn't understand the value
          ;; (e.g. "\textwidth").
          ,(format "#+ATTR_ORG: :width %s" orgwidth)
          ,(format "#+ATTR_LATEX: :width %s :float t"
                   width)
          ,(format "#+CAPTION: %s" caption)
          ,(format "#+NAME: %s" label)
          ,(format "[[file:%s]]"
                   (s-trim data))))
#+END_SRC
